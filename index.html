<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe Manager</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const Plus = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
    const Search = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>;
    const Calendar = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
    const ShoppingCart = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>;
    const Printer = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>;
    const Upload = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>;
    const X = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
    const Edit2 = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>;
    const Trash2 = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
    const ExternalLink = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>;
    const Copy = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>;

    function RecipeManager() {
      const [recipes, setRecipes] = useState([]);
      const [view, setView] = useState('recipes');
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedKeywords, setSelectedKeywords] = useState([]);
      const [editingRecipe, setEditingRecipe] = useState(null);
      const [mealPlan, setMealPlan] = useState([]);
      const [shoppingList, setShoppingList] = useState([]);
      const [showExportModal, setShowExportModal] = useState(false);
      const [exportData, setExportData] = useState('');
      const [showImportModal, setShowImportModal] = useState(false);
      const [showMealPlanModal, setShowMealPlanModal] = useState(false);
      const [selectedRecipeForPlan, setSelectedRecipeForPlan] = useState(null);
      const [printRecipe, setPrintRecipe] = useState(null);
      const [mealPlanView, setMealPlanView] = useState('rolling');
      const [printMealPlan, setPrintMealPlan] = useState(false);
      const [printShoppingList, setPrintShoppingList] = useState(false);
      const [viewingRecipe, setViewingRecipe] = useState(null);

      // Load data from localStorage on mount
      useEffect(() => {
        const savedRecipes = localStorage.getItem('recipes');
        const savedMealPlan = localStorage.getItem('mealPlan');
        if (savedRecipes) setRecipes(JSON.parse(savedRecipes));
        if (savedMealPlan) setMealPlan(JSON.parse(savedMealPlan));
      }, []);

      // Save recipes to localStorage whenever they change
      useEffect(() => {
        localStorage.setItem('recipes', JSON.stringify(recipes));
      }, [recipes]);

      // Save meal plan to localStorage whenever it changes
      useEffect(() => {
        localStorage.setItem('mealPlan', JSON.stringify(mealPlan));
      }, [mealPlan]);

      // Auto-delete old meals on load
      useEffect(() => {
        const today = new Date().toISOString().split('T')[0];
        setMealPlan(prev => {
          const filtered = prev.filter(meal => meal.date >= today);
          return filtered;
        });
      }, []);

      const handleExport = () => {
        const today = new Date().toISOString().split('T')[0];
        const futureMealPlan = mealPlan.filter(meal => meal.date >= today);
        const data = { recipes, mealPlan: futureMealPlan, exportDate: new Date().toISOString() };
        setExportData(JSON.stringify(data, null, 2));
        setShowExportModal(true);
      };

      const copyToClipboard = () => {
        navigator.clipboard.writeText(exportData).then(() => {
          alert('Data copied to clipboard!');
          setShowExportModal(false);
        }).catch(() => alert('Failed to copy.'));
      };

      const handleImport = (jsonText) => {
        try {
          const data = JSON.parse(jsonText);
          // Convert old image format to new imageUrl format
          const recipes = (data.recipes || []).map(r => {
            if (r.image && !r.imageUrl) {
              const { image, ...rest } = r;
              return rest; // Remove old image field
            }
            return r;
          });
          setRecipes(recipes);
          setMealPlan(data.mealPlan || []);
          alert('Data imported successfully!');
          setShowImportModal(false);
        } catch (error) {
          alert('Error importing data. Check the format: ' + error.message);
        }
      };

      const allKeywords = [...new Set(recipes.flatMap(r => r.keywords || []))].sort();
      const filteredRecipes = recipes.filter(recipe => {
        const matchesSearch = recipe.name.toLowerCase().includes(searchTerm.toLowerCase());
        const matchesKeywords = selectedKeywords.length === 0 || selectedKeywords.every(kw => recipe.keywords?.includes(kw));
        return matchesSearch && matchesKeywords;
      });

      const toggleKeyword = (kw) => setSelectedKeywords(prev => prev.includes(kw) ? prev.filter(k => k !== kw) : [...prev, kw]);

      const saveRecipe = (recipe) => {
        if (editingRecipe?.id) {
          setRecipes(prev => prev.map(r => r.id === recipe.id ? recipe : r));
        } else {
          setRecipes(prev => [...prev, { ...recipe, id: Date.now() }]);
        }
        setEditingRecipe(null);
      };

      const deleteRecipe = (id) => {
        if (confirm('Delete this recipe?')) {
          setRecipes(prev => prev.filter(r => r.id !== id));
          setMealPlan(prev => prev.filter(m => m.recipeId !== id));
        }
      };

      const addToMealPlan = (recipeId, date, mealType) => {
        const d = new Date(date);
        const dayOfWeek = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][d.getDay()];
        setMealPlan(prev => [...prev, { recipeId, date, dayOfWeek, mealType }]);
        setShowMealPlanModal(false);
        setSelectedRecipeForPlan(null);
      };

      const openMealPlanModal = (recipeId) => {
        setSelectedRecipeForPlan(recipeId);
        setShowMealPlanModal(true);
      };

      const getWeekDays = () => {
        const days = [];
        let startDate = new Date();
        if (mealPlanView === 'thisWeek') {
          const dow = startDate.getDay();
          startDate.setDate(startDate.getDate() + (dow === 0 ? -6 : 1 - dow));
        } else if (mealPlanView === 'nextWeek') {
          const dow = startDate.getDay();
          startDate.setDate(startDate.getDate() + (dow === 0 ? 1 : 8 - dow));
        } else if (mealPlanView === 'twoWeeks') {
          const dow = startDate.getDay();
          startDate.setDate(startDate.getDate() + (dow === 0 ? -6 : 1 - dow));
        }
        const numDays = mealPlanView === 'twoWeeks' ? 14 : 7;
        for (let i = 0; i < numDays; i++) {
          const date = new Date(startDate);
          date.setDate(startDate.getDate() + i);
          days.push({
            date: date.toISOString().split('T')[0],
            dayOfWeek: ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][date.getDay()],
            display: date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })
          });
        }
        return days;
      };

      const getMealsForDay = (date) => mealPlan.filter(m => m.date === date);

      const generateShoppingList = () => {
        const ing = {};
        mealPlan.forEach(meal => {
          const r = recipes.find(r => r.id === meal.recipeId);
          if (r?.ingredients) {
            r.ingredients.forEach(i => {
              const k = `${i.name}-${i.unit}`;
              if (ing[k]) ing[k].amount += parseFloat(i.amount) || 0;
              else ing[k] = { name: i.name, amount: parseFloat(i.amount) || 0, unit: i.unit, checked: false };
            });
          }
        });
        setShoppingList(Object.values(ing));
        setView('shopping');
      };

      return (
        <div className="min-h-screen bg-gray-50">
          <div className="bg-white shadow"><div className="max-w-7xl mx-auto px-4 py-4">
            <div className="flex items-center justify-between mb-4">
              <h1 className="text-2xl font-bold">My Recipe Database</h1>
              <div className="flex gap-2">
                <button onClick={handleExport} className="flex items-center gap-2 px-3 py-2 bg-gray-100 rounded hover:bg-gray-200"><Copy className="w-4 h-4"/>Export</button>
                <button onClick={() => setShowImportModal(true)} className="flex items-center gap-2 px-3 py-2 bg-gray-100 rounded hover:bg-gray-200"><Upload className="w-4 h-4"/>Import</button>
              </div>
            </div>
            <div className="flex gap-2">
              <button onClick={() => setView('recipes')} className={`flex items-center gap-2 px-4 py-2 rounded ${view === 'recipes' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}><Search className="w-4 h-4"/>Recipes</button>
              <button onClick={() => setView('meal-plan')} className={`flex items-center gap-2 px-4 py-2 rounded ${view === 'meal-plan' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}><Calendar className="w-4 h-4"/>Meal Plan ({mealPlan.length})</button>
              <button onClick={() => setView('shopping')} className={`flex items-center gap-2 px-4 py-2 rounded ${view === 'shopping' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}><ShoppingCart className="w-4 h-4"/>Shopping List</button>
            </div>
          </div></div>

          <div className="max-w-7xl mx-auto px-4 py-6">
            {view === 'recipes' && <RecipesView recipes={filteredRecipes} allKeywords={allKeywords} selectedKeywords={selectedKeywords} toggleKeyword={toggleKeyword} searchTerm={searchTerm} setSearchTerm={setSearchTerm} setEditingRecipe={setEditingRecipe} openMealPlanModal={openMealPlanModal} setPrintRecipe={setPrintRecipe} deleteRecipe={deleteRecipe} setViewingRecipe={setViewingRecipe} />}
            {view === 'meal-plan' && <MealPlanView getWeekDays={getWeekDays} getMealsForDay={getMealsForDay} recipes={recipes} mealPlan={mealPlan} setMealPlan={setMealPlan} mealPlanView={mealPlanView} setMealPlanView={setMealPlanView} setPrintMealPlan={setPrintMealPlan} generateShoppingList={generateShoppingList} />}
            {view === 'shopping' && <ShoppingView shoppingList={shoppingList} setShoppingList={setShoppingList} setPrintShoppingList={setPrintShoppingList} />}
            {editingRecipe && <RecipeEditor recipe={editingRecipe} onSave={saveRecipe} onCancel={() => setEditingRecipe(null)} />}
            {showExportModal && <ExportModal exportData={exportData} copyToClipboard={copyToClipboard} onClose={() => setShowExportModal(false)} />}
            {showImportModal && <ImportModal onImport={handleImport} onCancel={() => setShowImportModal(false)} />}
            {showMealPlanModal && selectedRecipeForPlan && <MealPlanModal recipe={recipes.find(r => r.id === selectedRecipeForPlan)} onAdd={addToMealPlan} onCancel={() => { setShowMealPlanModal(false); setSelectedRecipeForPlan(null); }} getWeekDays={getWeekDays} />}
            {viewingRecipe && <RecipeViewModal recipe={viewingRecipe} onClose={() => setViewingRecipe(null)} />}
            {printRecipe && <PrintRecipeView recipe={printRecipe} onClose={() => setPrintRecipe(null)} />}
            {printMealPlan && <PrintMealPlanView weekDays={getWeekDays()} mealPlan={mealPlan} recipes={recipes} onClose={() => setPrintMealPlan(false)} />}
            {printShoppingList && <PrintShoppingListView shoppingList={shoppingList} onClose={() => setPrintShoppingList(false)} />}
          </div>
        </div>
      );
    }

    function RecipesView({recipes, allKeywords, selectedKeywords, toggleKeyword, searchTerm, setSearchTerm, setEditingRecipe, openMealPlanModal, setPrintRecipe, deleteRecipe, setViewingRecipe}) {
      return (<div>
        <div className="mb-6 flex gap-4">
          <input type="text" placeholder="Search recipes..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="flex-1 px-4 py-2 border rounded-lg shadow-sm" />
          <button onClick={() => setEditingRecipe({})} className="flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 shadow-sm font-medium"><Plus className="w-4 h-4"/>Add Recipe</button>
        </div>
        {allKeywords.length > 0 && <div className="mb-6 flex flex-wrap gap-2">{allKeywords.map(kw => <button key={kw} onClick={() => toggleKeyword(kw)} className={`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${selectedKeywords.includes(kw) ? 'bg-blue-600 text-white shadow-sm' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>{kw}</button>)}</div>}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {recipes.map(r => <div key={r.id} className="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow overflow-hidden border border-gray-100">
            <div className="relative">
              {r.imageUrl ? (
                <img src={r.imageUrl} alt={r.name} className="w-full h-52 object-cover cursor-pointer" onClick={() => setViewingRecipe(r)} onError={(e) => {e.target.parentElement.innerHTML='<div class="w-full h-52 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-gray-400"><svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>'}}/>
              ) : (
                <div className="w-full h-52 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-gray-400 cursor-pointer" onClick={() => setViewingRecipe(r)}>
                  <svg className="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                </div>
              )}
              <div className="absolute top-3 right-3 flex gap-2">
                {r.keywords?.slice(0, 2).map(kw => <span key={kw} className="px-2.5 py-1 bg-white/90 backdrop-blur-sm text-xs font-medium text-gray-700 rounded-full shadow-sm">{kw}</span>)}
              </div>
            </div>
            <div className="p-5">
              <h3 className="font-bold text-xl mb-3 cursor-pointer hover:text-blue-600 transition-colors" onClick={() => setViewingRecipe(r)}>{r.name}</h3>
              <div className="flex items-center gap-4 text-sm text-gray-600 mb-4">
                {r.prepTime && <div className="flex items-center gap-1">‚è±Ô∏è <span>{r.prepTime}m</span></div>}
                {r.cookTime && <div className="flex items-center gap-1">üî• <span>{r.cookTime}m</span></div>}
                {r.serves && <div className="flex items-center gap-1">üçΩÔ∏è <span>{r.serves}</span></div>}
              </div>
              <div className="flex gap-2">
                <button onClick={() => setViewingRecipe(r)} className="flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                  <Search className="w-3.5 h-3.5"/>View
                </button>
                <button onClick={() => openMealPlanModal(r.id)} className="flex items-center justify-center gap-1.5 px-3 py-2 bg-green-50 text-green-700 rounded-lg text-sm font-medium hover:bg-green-100 transition-colors">
                  <Plus className="w-3.5 h-3.5"/>
                </button>
                <button onClick={() => setEditingRecipe(r)} className="flex items-center justify-center gap-1.5 px-3 py-2 bg-gray-50 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-100 transition-colors">
                  <Edit2 className="w-3.5 h-3.5"/>
                </button>
                <button onClick={() => setPrintRecipe(r)} className="flex items-center justify-center gap-1.5 px-3 py-2 bg-gray-50 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-100 transition-colors">
                  <Printer className="w-3.5 h-3.5"/>
                </button>
              </div>
            </div>
          </div>)}
        </div>
        {recipes.length === 0 && <div className="text-center py-16 text-gray-400"><div className="text-6xl mb-4">üç≥</div><div className="text-xl font-medium">No recipes yet</div><div className="text-sm mt-2">Click "Add Recipe" to get started</div></div>}
      </div>);
    }

    function RecipeViewModal({recipe, onClose}) {
      const [servingMultiplier, setServingMultiplier] = useState(1);
      const originalServes = parseFloat(recipe.serves) || 1;
      const scaledServes = Math.round(originalServes * servingMultiplier * 10) / 10;
      
      return (<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div className="bg-white rounded-lg max-w-4xl w-full my-8">
          <div className="p-6 border-b flex justify-between items-center">
            <h2 className="text-2xl font-bold">{recipe.name}</h2>
            <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded"><X className="w-6 h-6"/></button>
          </div>
          <div className="p-6 space-y-4">
            {recipe.imageUrl && <img src={recipe.imageUrl} alt={recipe.name} className="w-full h-64 object-cover rounded"/>}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
              {recipe.prepTime && <div className="bg-gray-50 p-3 rounded"><div className="text-xs text-gray-500">Prep Time</div><div className="font-semibold">{recipe.prepTime} min</div></div>}
              {recipe.cookTime && <div className="bg-gray-50 p-3 rounded"><div className="text-xs text-gray-500">Cook Time</div><div className="font-semibold">{recipe.cookTime} min</div></div>}
              {recipe.serves && <div className="bg-gray-50 p-3 rounded"><div className="text-xs text-gray-500">Serves</div><div className="font-semibold">{scaledServes}</div></div>}
              {recipe.source && <div className="bg-gray-50 p-3 rounded"><div className="text-xs text-gray-500">Source</div><div className="font-semibold text-sm">{recipe.source}</div></div>}
            </div>
            
            {recipe.serves && <div className="bg-blue-50 p-4 rounded-lg">
              <div className="text-sm font-semibold mb-2">Scale Recipe:</div>
              <div className="flex items-center gap-3">
                <button onClick={() => setServingMultiplier(0.5)} className={`px-3 py-1 rounded ${servingMultiplier === 0.5 ? 'bg-blue-600 text-white' : 'bg-white'}`}>¬Ωx</button>
                <button onClick={() => setServingMultiplier(1)} className={`px-3 py-1 rounded ${servingMultiplier === 1 ? 'bg-blue-600 text-white' : 'bg-white'}`}>1x</button>
                <button onClick={() => setServingMultiplier(1.5)} className={`px-3 py-1 rounded ${servingMultiplier === 1.5 ? 'bg-blue-600 text-white' : 'bg-white'}`}>1.5x</button>
                <button onClick={() => setServingMultiplier(2)} className={`px-3 py-1 rounded ${servingMultiplier === 2 ? 'bg-blue-600 text-white' : 'bg-white'}`}>2x</button>
                <button onClick={() => setServingMultiplier(3)} className={`px-3 py-1 rounded ${servingMultiplier === 3 ? 'bg-blue-600 text-white' : 'bg-white'}`}>3x</button>
              </div>
            </div>}
            
            {recipe.recipeLink && <div><a href={recipe.recipeLink} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline flex items-center gap-2"><ExternalLink className="w-4 h-4"/>View Original Recipe</a></div>}
            {recipe.keywords?.length > 0 && <div className="flex flex-wrap gap-2">{recipe.keywords.map(kw => <span key={kw} className="px-3 py-1 bg-blue-100 text-blue-700 text-sm rounded">{kw}</span>)}</div>}
            {recipe.collection && <div className="flex items-center gap-2"><span className="text-sm font-semibold">Collection:</span><span className="px-3 py-1 bg-purple-100 text-purple-700 text-sm rounded">{recipe.collection}</span></div>}
            
            {(recipe.calories || recipe.protein || recipe.carbs || recipe.fat) && <div className="bg-green-50 p-4 rounded-lg">
              <div className="text-sm font-semibold mb-3">Nutrition per serving:</div>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                {recipe.calories && <div className="bg-white p-2 rounded text-center"><div className="text-xs text-gray-500">Calories</div><div className="font-bold text-green-700">{Math.round(recipe.calories * servingMultiplier / (originalServes || 1))}</div></div>}
                {recipe.protein && <div className="bg-white p-2 rounded text-center"><div className="text-xs text-gray-500">Protein</div><div className="font-bold text-green-700">{Math.round(recipe.protein * servingMultiplier / (originalServes || 1))}g</div></div>}
                {recipe.carbs && <div className="bg-white p-2 rounded text-center"><div className="text-xs text-gray-500">Carbs</div><div className="font-bold text-green-700">{Math.round(recipe.carbs * servingMultiplier / (originalServes || 1))}g</div></div>}
                {recipe.fat && <div className="bg-white p-2 rounded text-center"><div className="text-xs text-gray-500">Fat</div><div className="font-bold text-green-700">{Math.round(recipe.fat * servingMultiplier / (originalServes || 1))}g</div></div>}
              </div>
            </div>}
            
            {recipe.rating && <div className="flex items-center gap-2">
              <span className="text-sm font-semibold">Rating:</span>
              <div className="flex gap-1">
                {[1,2,3,4,5].map(star => <span key={star} className={star <= recipe.rating ? 'text-yellow-400' : 'text-gray-300'}>‚òÖ</span>)}
              </div>
            </div>}
            
            {recipe.lastMade && <div className="text-sm text-gray-500">Last made: {new Date(recipe.lastMade).toLocaleDateString()}</div>}
            
            {recipe.notes && <div className="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400">
              <div className="text-sm font-semibold mb-1">My Notes:</div>
              <div className="text-sm text-gray-700 whitespace-pre-wrap">{recipe.notes}</div>
            </div>}
            
            <div><h3 className="text-lg font-bold mb-2">Ingredients</h3><ul className="list-disc list-inside space-y-1">{recipe.ingredients?.map((i, idx) => <li key={idx}>{Math.round((parseFloat(i.amount) * servingMultiplier) * 100) / 100} {i.unit} {i.name}</li>)}</ul></div>
            <div><h3 className="text-lg font-bold mb-2">Steps</h3><ol className="list-decimal list-inside space-y-2">{recipe.steps?.map((s, idx) => <li key={idx} className="mb-2">{s}</li>)}</ol></div>
          </div>
          <div className="p-6 border-t flex gap-3">
            <button onClick={onClose} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Close</button>
          </div>
        </div>
      </div>);
    }

    function MealPlanView({getWeekDays, getMealsForDay, recipes, mealPlan, setMealPlan, mealPlanView, setMealPlanView, setPrintMealPlan, generateShoppingList}) {
      return (<div>
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-xl font-bold">Meal Plan</h2>
          <div className="flex gap-2">
            <select value={mealPlanView} onChange={(e) => setMealPlanView(e.target.value)} className="px-3 py-2 border rounded">
              <option value="rolling">Next 7 Days</option>
              <option value="thisWeek">This Week (Mon-Sun)</option>
              <option value="nextWeek">Next Week (Mon-Sun)</option>
              <option value="twoWeeks">Next 2 Weeks</option>
            </select>
            <button onClick={() => setPrintMealPlan(true)} className="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700"><Printer className="w-4 h-4"/>Print</button>
            <button onClick={generateShoppingList} className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"><ShoppingCart className="w-4 h-4"/>Shopping List</button>
          </div>
        </div>
        <div className="space-y-4">{getWeekDays().map(day => {
          const meals = getMealsForDay(day.date);
          return <div key={day.date} className="bg-white rounded-lg shadow">
            <div className="bg-gray-100 px-4 py-3 font-semibold border-b">{day.display}</div>
            <div className="p-4">{['breakfast','lunch','dinner','snack'].map(mt => {
              const m = meals.find(m => m.mealType === mt);
              const r = m ? recipes.find(r => r.id === m.recipeId) : null;
              return <div key={mt} className="flex items-center gap-4 py-2 border-b last:border-b-0">
                <div className="w-24 text-sm font-medium text-gray-600 capitalize">{mt}</div>
                {m && r ? <div className="flex-1 flex items-center justify-between">
                  <div><div className="font-medium">{r.name}</div>{r.prepTime && r.cookTime && <div className="text-xs text-gray-500">{parseInt(r.prepTime)+parseInt(r.cookTime)} min</div>}</div>
                  <button onClick={() => setMealPlan(prev => prev.filter(meal => meal !== m))} className="p-2 text-red-600 hover:bg-red-50 rounded"><X className="w-4 h-4"/></button>
                </div> : <div className="flex-1 text-sm text-gray-400">No meal</div>}
              </div>;
            })}</div>
          </div>;
        })}</div>
        {mealPlan.length === 0 && <div className="bg-white rounded-lg shadow p-8 text-center text-gray-500">No meals planned.</div>}
      </div>);
    }

    function ShoppingView({shoppingList, setShoppingList, setPrintShoppingList}) {
      return (<div>
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-xl font-bold">Shopping List</h2>
          <button onClick={() => setPrintShoppingList(true)} className="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700"><Printer className="w-4 h-4"/>Print</button>
        </div>
        <div className="bg-white rounded-lg shadow p-4">
          {shoppingList.map((item, idx) => <div key={idx} className="flex items-center gap-3 py-2 border-b last:border-b-0">
            <input type="checkbox" checked={item.checked} onChange={() => setShoppingList(prev => prev.map((it, i) => i === idx ? {...it, checked: !it.checked} : it))} className="w-5 h-5"/>
            <span className={item.checked ? 'line-through text-gray-400' : ''}>{item.amount} {item.unit} {item.name}</span>
          </div>)}
          {shoppingList.length === 0 && <div className="py-8 text-center text-gray-500">No items.</div>}
        </div>
      </div>);
    }

    function RecipeEditor({recipe, onSave, onCancel}) {
      const [formData, setFormData] = useState({
        name: recipe.name || '', keywords: recipe.keywords?.join(', ') || '', prepTime: recipe.prepTime || '', cookTime: recipe.cookTime || '',
        serves: recipe.serves || '', source: recipe.source || '', recipeLink: recipe.recipeLink || '', collection: recipe.collection || '',
        ingredients: recipe.ingredients || [{name:'',amount:'',unit:'g'}], steps: recipe.steps?.join('\n') || '', 
        imageUrl: recipe.imageUrl || '', rating: recipe.rating || 0, notes: recipe.notes || '',
        calories: recipe.calories || '', protein: recipe.protein || '', carbs: recipe.carbs || '', fat: recipe.fat || '',
        lastMade: recipe.lastMade || ''
      });
      const units = ['g','kg','oz','lb','ml','l','cup','tbsp','tsp','piece','whole','each'];
      const addIng = () => setFormData({...formData, ingredients: [...formData.ingredients, {name:'',amount:'',unit:'g'}]});
      const updateIng = (i, f, v) => { const ings = [...formData.ingredients]; ings[i][f] = v; setFormData({...formData, ingredients: ings}); };
      const removeIng = (i) => setFormData({...formData, ingredients: formData.ingredients.filter((_, idx) => idx !== i)});
      const handleSubmit = () => {
        if (!formData.name.trim()) return alert('Enter recipe name');
        const validIngs = formData.ingredients.filter(ing => ing.name.trim());
        if (validIngs.length === 0) return alert('Add at least one ingredient');
        onSave({...recipe, name: formData.name, keywords: formData.keywords.split(',').map(k => k.trim()).filter(Boolean),
          prepTime: formData.prepTime, cookTime: formData.cookTime, serves: formData.serves, source: formData.source,
          recipeLink: formData.recipeLink, ingredients: validIngs, steps: formData.steps.split('\n').filter(Boolean),
          imageUrl: formData.imageUrl, collection: formData.collection, rating: parseInt(formData.rating) || 0,
          notes: formData.notes, calories: parseFloat(formData.calories) || 0, protein: parseFloat(formData.protein) || 0,
          carbs: parseFloat(formData.carbs) || 0, fat: parseFloat(formData.fat) || 0, lastMade: formData.lastMade});
      };
      return (<div className="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center p-4 z-50 overflow-y-auto py-8">
        <div className="bg-white rounded-lg max-w-4xl w-full my-8">
          <div className="p-6 border-b sticky top-0 bg-white z-10"><h2 className="text-2xl font-bold">{recipe.id ? 'Edit' : 'New'} Recipe</h2></div>
          <div className="p-6 space-y-4">
            <div className="grid grid-cols-2 gap-4">
              <div className="col-span-2"><label className="block font-semibold mb-1">Recipe Name *</label><input type="text" value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} className="w-full px-3 py-2 border rounded"/></div>
              <div><label className="block font-semibold mb-1">Prep (min)</label><input type="number" value={formData.prepTime} onChange={(e) => setFormData({...formData, prepTime: e.target.value})} className="w-full px-3 py-2 border rounded"/></div>
              <div><label className="block font-semibold mb-1">Cook (min)</label><input type="number" value={formData.cookTime} onChange={(e) => setFormData({...formData, cookTime: e.target.value})} className="w-full px-3 py-2 border rounded"/></div>
              <div><label className="block font-semibold mb-1">Source</label><input type="text" value={formData.source} onChange={(e) => setFormData({...formData, source: e.target.value})} className="w-full px-3 py-2 border rounded"/></div>
              <div className="col-span-2"><label className="block font-semibold mb-1">Recipe Link</label><input type="url" value={formData.recipeLink} onChange={(e) => setFormData({...formData, recipeLink: e.target.value})} className="w-full px-3 py-2 border rounded" placeholder="https://example.com/recipe"/></div>
            </div>
            <div><label className="block font-semibold mb-1">Image URL (Google Drive or any image link)</label>
              {formData.imageUrl && <div className="mb-2"><img src={formData.imageUrl} alt="Preview" className="w-full h-48 object-cover rounded" onError={(e) => {e.target.style.display='none'}}/></div>}
              <input type="url" value={formData.imageUrl} onChange={(e) => setFormData({...formData, imageUrl: e.target.value})} placeholder="https://drive.google.com/..." className="w-full px-3 py-2 border rounded"/>
              <p className="text-xs text-gray-500 mt-1">Upload image to Google Drive, get shareable link, paste here</p>
            </div>
            <div><label className="block font-semibold mb-1">Keywords</label><input type="text" value={formData.keywords} onChange={(e) => setFormData({...formData, keywords: e.target.value})} placeholder="vegetarian, quick" className="w-full px-3 py-2 border rounded"/></div>
            <div><label className="block font-semibold mb-2">Ingredients *</label>
              <div className="space-y-2">
                {formData.ingredients.map((ing, i) => <div key={i} className="flex gap-2">
                  <input type="number" value={ing.amount} onChange={(e) => updateIng(i, 'amount', e.target.value)} placeholder="250" className="w-24 px-3 py-2 border rounded"/>
                  <select value={ing.unit} onChange={(e) => updateIng(i, 'unit', e.target.value)} className="w-28 px-3 py-2 border rounded">{units.map(u => <option key={u} value={u}>{u}</option>)}</select>
                  <input type="text" value={ing.name} onChange={(e) => updateIng(i, 'name', e.target.value)} placeholder="flour" className="flex-1 px-3 py-2 border rounded"/>
                  <button onClick={() => removeIng(i)} className="px-3 py-2 bg-red-100 text-red-600 rounded hover:bg-red-200"><X className="w-4 h-4"/></button>
                </div>)}
                <button onClick={addIng} className="flex items-center gap-2 px-3 py-2 bg-green-100 text-green-700 rounded hover:bg-green-200"><Plus className="w-4 h-4"/>Add</button>
              </div>
            </div>
            <div><label className="block font-semibold mb-1">Steps *</label><textarea value={formData.steps} onChange={(e) => setFormData({...formData, steps: e.target.value})} className="w-full px-3 py-2 border rounded h-32" placeholder="1. Step one&#10;2. Step two"/></div>
            <div><label className="block font-semibold mb-1">Nutrition</label><input type="text" value={formData.nutrition} onChange={(e) => setFormData({...formData, nutrition: e.target.value})} placeholder="450 cal" className="w-full px-3 py-2 border rounded"/></div>
          </div>
          <div className="flex gap-3 p-6 border-t sticky bottom-0 bg-white">
            <button onClick={handleSubmit} className="flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
            <button onClick={onCancel} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
          </div>
        </div>
      </div>);
    }

    function ExportModal({exportData, copyToClipboard, onClose}) {
      return (<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div className="bg-white rounded-lg max-w-2xl w-full p-6">
          <h2 className="text-xl font-bold mb-4">Export Your Recipes</h2>
          <p className="text-sm text-gray-600 mb-4">Copy this data and save it to a text file in Google Drive for backup.</p>
          <textarea value={exportData} readOnly className="w-full h-64 px-3 py-2 border rounded font-mono text-xs mb-4" onClick={(e) => e.target.select()}/>
          <div className="flex gap-3">
            <button onClick={copyToClipboard} className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"><Copy className="w-4 h-4"/>Copy</button>
            <button onClick={onClose} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Close</button>
          </div>
        </div>
      </div>);
    }

    function ImportModal({onImport, onCancel}) {
      const [importText, setImportText] = useState('');
      return (<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div className="bg-white rounded-lg max-w-2xl w-full p-6">
          <h2 className="text-xl font-bold mb-4">Import Your Recipes</h2>
          <p className="text-sm text-gray-600 mb-4">Paste your exported JSON data:</p>
          <textarea value={importText} onChange={(e) => setImportText(e.target.value)} placeholder="Paste here..." className="w-full h-64 px-3 py-2 border rounded font-mono text-xs mb-4"/>
          <div className="flex gap-3">
            <button onClick={() => onImport(importText)} className="flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Import</button>
            <button onClick={onCancel} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
          </div>
        </div>
      </div>);
    }

    function MealPlanModal({recipe, onAdd, onCancel, getWeekDays}) {
      const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
      const [selectedMealType, setSelectedMealType] = useState('dinner');
      const weekDays = getWeekDays();
      return (<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div className="bg-white rounded-lg max-w-md w-full p-6">
          <h2 className="text-xl font-bold mb-4">Add to Meal Plan</h2>
          <p className="text-sm text-gray-600 mb-4"><strong>{recipe.name}</strong></p>
          <div className="space-y-4">
            <div><label className="block font-semibold mb-2">Day</label>
              <select value={selectedDate} onChange={(e) => setSelectedDate(e.target.value)} className="w-full px-3 py-2 border rounded">
                {weekDays.map(d => <option key={d.date} value={d.date}>{d.display}</option>)}
              </select>
            </div>
            <div><label className="block font-semibold mb-2">Meal</label>
              <div className="grid grid-cols-2 gap-2">
                {['breakfast','lunch','dinner','snack'].map(m => <button key={m} onClick={() => setSelectedMealType(m)} className={`px-4 py-2 rounded capitalize ${selectedMealType === m ? 'bg-blue-600 text-white' : 'bg-gray-100 hover:bg-gray-200'}`}>{m}</button>)}
              </div>
            </div>
          </div>
          <div className="flex gap-3 mt-6">
            <button onClick={() => onAdd(recipe.id, selectedDate, selectedMealType)} className="flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Add</button>
            <button onClick={onCancel} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
          </div>
        </div>
      </div>);
    }

    function PrintRecipeView({recipe, onClose}) {
      return (<div className="fixed inset-0 bg-white z-50 overflow-auto">
        <style>{`@media print{.no-print{display:none!important}@page{size:A4;margin:0}}.print-container{font-family:Arial,sans-serif;font-size:10pt}.recipe-half{height:50vh;padding:1cm;box-sizing:border-box}.recipe-half h1{font-size:14pt;margin:0 0 .3cm;border-bottom:2px solid #333;padding-bottom:.2cm}.recipe-half .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:.2cm;margin-bottom:.4cm;font-size:9pt}.recipe-half .keywords{color:#666;font-size:8pt;margin-bottom:.3cm}.recipe-half h2{font-size:11pt;margin:.4cm 0 .2cm;color:#333}.recipe-half ul,.recipe-half ol{margin:0;padding-left:1.2em}.recipe-half li{margin-bottom:.15cm;font-size:9pt}.recipe-half .nutrition{font-size:8pt;color:#666;margin-top:.3cm;padding-top:.3cm;border-top:1px solid #ccc}.cut-line{text-align:center;color:#999;font-size:8pt;padding:.2cm 0;border-top:1px dashed #999}`}</style>
        <div className="no-print fixed top-4 right-4 bg-white p-4 rounded-lg shadow-lg border-2 border-gray-300 flex gap-3">
          <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"><Printer className="w-4 h-4"/>Print</button>
          <button onClick={onClose} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Close</button>
        </div>
        <div className="print-container">
          <div className="recipe-half">
            <h1>{recipe.name}</h1>
            <div className="info-grid">
              {recipe.prepTime && <div><strong>Prep:</strong> {recipe.prepTime} min</div>}
              {recipe.cookTime && <div><strong>Cook:</strong> {recipe.cookTime} min</div>}
              {recipe.serves && <div><strong>Serves:</strong> {recipe.serves}</div>}
              {recipe.source && <div><strong>Source:</strong> {recipe.source}</div>}
            </div>
            {recipe.keywords?.length > 0 && <div className="keywords">{recipe.keywords.join(', ')}</div>}
            <h2>Ingredients</h2>
            <ul>{recipe.ingredients?.map((i, idx) => <li key={idx}>{i.amount} {i.unit} {i.name}</li>)}</ul>
            <h2>Steps</h2>
            <ol>{recipe.steps?.map((s, idx) => <li key={idx}>{s}</li>)}</ol>
            {recipe.nutrition && <div className="nutrition">Nutrition: {recipe.nutrition}</div>}
          </div>
          <div className="cut-line">‚úÇ Cut along this line ‚úÇ</div>
          <div className="recipe-half">
            <h1>{recipe.name}</h1>
            <div className="info-grid">
              {recipe.prepTime && <div><strong>Prep:</strong> {recipe.prepTime} min</div>}
              {recipe.cookTime && <div><strong>Cook:</strong> {recipe.cookTime} min</div>}
              {recipe.serves && <div><strong>Serves:</strong> {recipe.serves}</div>}
              {recipe.source && <div><strong>Source:</strong> {recipe.source}</div>}
            </div>
            {recipe.keywords?.length > 0 && <div className="keywords">{recipe.keywords.join(', ')}</div>}
            <h2>Ingredients</h2>
            <ul>{recipe.ingredients?.map((i, idx) => <li key={idx}>{i.amount} {i.unit} {i.name}</li>)}</ul>
            <h2>Steps</h2>
            <ol>{recipe.steps?.map((s, idx) => <li key={idx}>{s}</li>)}</ol>
            {recipe.nutrition && <div className="nutrition">Nutrition: {recipe.nutrition}</div>}
          </div>
        </div>
      </div>);
    }

    function PrintMealPlanView({weekDays, mealPlan, recipes, onClose}) {
      const getMealsForDay = (date) => mealPlan.filter(m => m.date === date);
      return (<div className="fixed inset-0 bg-white z-50 overflow-auto">
        <style>{`@media print{.no-print{display:none!important}@page{size:A4;margin:1.5cm}}.meal-plan-print{font-family:Arial,sans-serif;padding:1cm}.meal-plan-print h1{font-size:18pt;margin-bottom:1cm;text-align:center;border-bottom:3px solid #333;padding-bottom:.5cm}.day-section{margin-bottom:.8cm;page-break-inside:avoid}.day-header{font-size:14pt;font-weight:bold;background:#f0f0f0;padding:.3cm;margin-bottom:.3cm}.meal-row{display:grid;grid-template-columns:120px 1fr;padding:.2cm 0;border-bottom:1px solid #ddd}.meal-type{font-weight:bold;text-transform:capitalize}.meal-name{color:#333}.meal-time{font-size:9pt;color:#666}`}</style>
        <div className="no-print fixed top-4 right-4 bg-white p-4 rounded-lg shadow-lg border-2 border-gray-300 flex gap-3">
          <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"><Printer className="w-4 h-4"/>Print</button>
          <button onClick={onClose} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Close</button>
        </div>
        <div className="meal-plan-print">
          <h1>Meal Plan</h1>
          {weekDays.map(day => {
            const meals = getMealsForDay(day.date);
            return (<div key={day.date} className="day-section">
              <div className="day-header">{day.display}</div>
              {['breakfast','lunch','dinner','snack'].map(mt => {
                const m = meals.find(meal => meal.mealType === mt);
                const r = m ? recipes.find(rec => rec.id === m.recipeId) : null;
                return (<div key={mt} className="meal-row">
                  <div className="meal-type">{mt}</div>
                  <div>
                    {r ? (<><div className="meal-name">{r.name}</div>{r.prepTime && r.cookTime && <div className="meal-time">{parseInt(r.prepTime)+parseInt(r.cookTime)} min</div>}</>):(<div style={{color:'#999'}}>‚Äî</div>)}
                  </div>
                </div>);
              })}
            </div>);
          })}
        </div>
      </div>);
    }

    function PrintShoppingListView({shoppingList, onClose}) {
      return (<div className="fixed inset-0 bg-white z-50 overflow-auto">
        <style>{`@media print{.no-print{display:none!important}@page{size:A4;margin:1.5cm}}.shopping-list-print{font-family:Arial,sans-serif;padding:1cm}.shopping-list-print h1{font-size:18pt;margin-bottom:1cm;text-align:center;border-bottom:3px solid #333;padding-bottom:.5cm}.shopping-item{display:flex;align-items:center;padding:.3cm 0;border-bottom:1px solid #ddd;font-size:11pt}.checkbox{width:.5cm;height:.5cm;border:2px solid #333;margin-right:.5cm;flex-shrink:0}`}</style>
        <div className="no-print fixed top-4 right-4 bg-white p-4 rounded-lg shadow-lg border-2 border-gray-300 flex gap-3">
          <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"><Printer className="w-4 h-4"/>Print</button>
          <button onClick={onClose} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Close</button>
        </div>
        <div className="shopping-list-print">
          <h1>Shopping List</h1>
          {shoppingList.map((item, idx) => (<div key={idx} className="shopping-item"><div className="checkbox"></div><div>{item.amount} {item.unit} {item.name}</div></div>))}
          {shoppingList.length === 0 && <div style={{textAlign:'center',color:'#999',marginTop:'2cm'}}>No items</div>}
        </div>
      </div>);
    }

    ReactDOM.render(<RecipeManager />, document.getElementById('root'));
  </script>
</body>
</html>
